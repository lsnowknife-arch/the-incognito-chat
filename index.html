<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incognito Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
    <style>
        body { background: #010409; color: #e6edf3; font-family: sans-serif; }
        .glass { background: rgba(13, 17, 23, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .msg { animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-lg glass rounded-3xl overflow-hidden flex flex-col h-[80vh]">
        <div class="p-6 border-b border-white/10 flex justify-between items-center">
            <div>
                <h1 class="font-bold text-white tracking-tight">INCOGNITO</h1>
                <p id="status" class="text-[10px] text-yellow-500 uppercase font-bold tracking-widest">Disconnected</p>
            </div>
            <input type="text" id="room-input" placeholder="Room Name..." class="bg-black/50 border border-white/10 rounded-lg px-3 py-1 text-xs outline-none focus:border-blue-500 text-white">
            <button onclick="joinRoom()" class="text-[10px] bg-blue-600 px-3 py-1 rounded-md font-bold">JOIN</button>
        </div>

        <div id="thread" class="flex-1 overflow-y-auto p-6 space-y-4 flex flex-col"></div>

        <div class="p-4 bg-black/20 border-t border-white/10 flex gap-2">
            <input type="text" id="msg-input" placeholder="Type a message..." class="flex-1 bg-transparent outline-none text-sm px-2">
            <button onclick="send()" class="bg-blue-600 px-6 py-2 rounded-xl font-bold text-xs">SEND</button>
        </div>
    </div>

    <script>
        let peer, conn;

        function joinRoom() {
            const room = document.getElementById('room-input').value.trim();
            if (!room) return alert("Enter a room name");

            document.getElementById('status').innerText = "Joining...";
            
            // We use the room name as the base for the ID
            // Since two people can't have the same ID, we suffix them
            const isCreator = Math.random() > 0.5;
            const myId = isCreator ? room + "_1" : room + "_2";
            const targetId = isCreator ? room + "_2" : room + "_1";

            peer = new Peer(myId);

            peer.on('open', () => {
                document.getElementById('status').innerText = "Room Active. Waiting...";
                // Attempt to connect to the other possible ID in the room
                setTimeout(() => {
                    const call = peer.connect(targetId);
                    if (call) handleConn(call);
                }, 1000);
            });

            peer.on('connection', handleConn);
            
            peer.on('error', (err) => {
                if (err.type === 'peer-unavailable') {
                    // This is fine, it just means the other person isn't there yet
                } else {
                    console.error(err);
                }
            });
        }

        function handleConn(c) {
            conn = c;
            conn.on('open', () => {
                document.getElementById('status').innerText = "Connected";
                document.getElementById('status').classList.replace('text-yellow-500', 'text-green-500');
            });
            conn.on('data', data => render(data, 'them'));
        }

        function send() {
            const input = document.getElementById('msg-input');
            if (!input.value || !conn) return;
            conn.send(input.value);
            render(input.value, 'me');
            input.value = "";
        }

        function render(text, side) {
            const div = document.createElement('div');
            div.className = `msg flex ${side === 'me' ? 'justify-end' : 'justify-start'}`;
            div.innerHTML = `<div class="p-3 px-4 max-w-[80%] rounded-2xl text-sm ${side === 'me' ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-200'}">${text}</div>`;
            document.getElementById('thread').appendChild(div);
            const t = document.getElementById('thread'); t.scrollTop = t.scrollHeight;
        }

        document.getElementById('msg-input').onkeydown = e => e.key === 'Enter' && send();
    </script>
</body>
</html>